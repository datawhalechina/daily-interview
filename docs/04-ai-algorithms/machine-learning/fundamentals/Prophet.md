

## Propheté¢è¯•é¢?

## 1. ç®€è¦ä»‹ç»Prophet

å¸¸è§çš„æ—¶é—´åºåˆ—åˆ†è§£æ–¹æ³•ï¼š

å°†æ—¶é—´åºåˆ—åˆ†æˆå­£èŠ‚é¡¹$S_t$ï¼Œè¶‹åŠ¿é¡¹$T_t$ï¼Œå‰©ä½™é¡¹$R_t$ï¼Œå³å¯¹æ‰€æœ‰çš„$tâ‰?$
$$
y_{t}=S_{t}+T_{t}+R_{t}	
$$

$$
y_{t}=S_{t} \times T_{t} \times R_{t}
$$

$$
\ln y_{t}=\ln S_{t}+\ln T_{t}+\ln R_{t}
$$

fbprophet çš„åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ·»åŠ äº†èŠ‚æ—¥é¡¹ã€?
$$
y(t)=g(t)+s(t)+h(t)+\epsilon_{t}
$$

## 2. è¶‹åŠ¿é¡¹æ¨¡å?

* **åŸºäºé€»è¾‘å›å½’**

   sigmoid å‡½æ•°ä¸?
  $$
  \sigma(x)=1 /\left(1+e^{-x}\right)
  $$
  prophetåœ¨é€»è¾‘å›å½’çš„åŸºç¡€ä¸Šæ·»åŠ äº†éšæ—¶é—´å˜åŒ–çš„å‚æ•°ï¼Œé‚£ä¹ˆé€»è¾‘å›å½’å°±å¯ä»¥æ”¹å†™æˆï¼?
  $$
  f(x)=\frac{C(t)}{\left(1+e^{-k(t)(x-m(t))}\right)}
  $$
  è¿™é‡Œçš?$C$ ç§°ä¸ºæ›²çº¿çš„æœ€å¤§æ¸è¿‘å€¼ï¼Œ $k$ è¡¨ç¤ºæ›²çº¿çš„å¢é•¿ç‡ï¼?m$  è¡¨ç¤ºæ›²çº¿çš„ä¸­ç‚¹ã€‚å½“ $$
  C=1, k=1, m=0
  $$æ—¶ï¼Œæ°å¥½å°±æ˜¯å¤§å®¶å¸¸è§çš?sigmoid å‡½æ•°çš„å½¢å¼ã€?

* **åŸºäºåˆ†æ®µçº¿æ€§å‡½æ•?*
  $$
  g(t)=\frac{C(t)}{1+\exp \left(-\left(k+\boldsymbol{a}(t)^{t} \boldsymbol{\delta}\right) \cdot\left(t-\left(m+\boldsymbol{a}(t)^{T} \boldsymbol{\gamma}\right)\right.\right.}
  $$
  $k$è¡¨ç¤ºå˜åŒ–é‡?

  $a_{j}(t)$è¡¨ç¤ºæŒ‡ç¤ºå‡½æ•°ï¼?
  $$
  a_{j}(t)=\left\{\begin{array}{l}1, \text { if } t \geq s_{j} \\ 0, \text { otherwise }\end{array}\right.
  $$
  $\delta_{j}$è¡¨ç¤ºåœ¨æ—¶é—´æˆ³$s_{j}$ä¸Šçš„å¢é•¿ç‡çš„å˜åŒ–é‡?

  $\gamma_{j}$ç¡®å®šçº¿æ®µè¾¹ç•Œ
  $$
  \gamma_{j}=\left(s_{j}-m-\sum_{\ell<j} \gamma_{\ell}\right) \cdot\left(1-\frac{k+\sum_{\ell<j} \delta_{\ell}}{k+\sum_{\ell \leq j} \delta_{\ell}}\right)
  $$
  å…¶ä¸­ï¼?
  $$
  \boldsymbol{a}(t)=\left(a_{1}(t), \cdots, a_{S}(t)\right)^{T}, \boldsymbol{\delta}=\left(\delta_{1}, \cdots, \delta_{S}\right)^{T}, \boldsymbol{\gamma}=\left({\gamma}_{1}, \cdots, \gamma_{S}\right)^{T}
  $$

## 3. å˜ç‚¹çš„é€‰æ‹©

åœ?Prophet ç®—æ³•ä¸­ï¼Œéœ€è¦ç»™å‡ºå˜ç‚¹çš„ä½ç½®ï¼Œä¸ªæ•°ï¼Œä»¥åŠå¢é•¿çš„å˜åŒ–ç‡ï¼?

- changepoint_range

  changepoint_range æŒ‡çš„æ˜¯ç™¾åˆ†æ¯”ï¼Œéœ€è¦åœ¨å‰?changepoint_range é‚£ä¹ˆé•¿çš„æ—¶é—´åºåˆ—ä¸­è®¾ç½®å˜ç‚?

- n_changepoint

  n_changepoint è¡¨ç¤ºå˜ç‚¹çš„ä¸ªæ•°ï¼Œåœ¨é»˜è®¤çš„å‡½æ•°ä¸­æ˜¯ n_changepoint = 25

- changepoint_prior_scaleã€?

  changepoint_prior_scale è¡¨ç¤ºå˜ç‚¹å¢é•¿ç‡çš„åˆ†å¸ƒæƒ…å†µ
  $$
  \delta_{j} \sim \operatorname{Laplace}(0, \tau)
  $$
  $\mathcal{T}$å°±æ˜¯ change_point_scale

## 4. å¯¹æœªæ¥çš„é¢„ä¼°

å¯¹äºå·²çŸ¥çš„æ—¶é—´åºåˆ—ï¼Œå¯ä»¥æ‰‹åŠ¨è®¾ç½®sä¸ªå˜ç‚?

å¯¹äºé¢„æµ‹çš„æ•°æ®æ¨¡å‹ä½¿ç”¨Poissonåˆ†å¸ƒæ‰¾åˆ°æ–°å¢çš„å˜ç‚¹ï¼Œç„¶åä¸å·²çŸ¥çš„å˜ç‚¹è¿›è¡Œæ‹¼æ¥

## 5. å­£èŠ‚æ€§è¶‹åŠ?

æ—¶é—´åºåˆ—é€šå¸¸ä¼šéšç€å¤©ï¼Œå‘¨ï¼Œæœˆï¼Œå¹´ç­‰å­£èŠ‚æ€§çš„å˜åŒ–è€Œå‘ˆç°å­£èŠ‚æ€§çš„å˜åŒ–ï¼Œä¹Ÿç§°ä¸ºå‘¨æœŸæ€§çš„å˜åŒ–

prophetç®—æ³•ä½¿ç”¨å‚…ç«‹å¶çº§æ•°æ¥æ¨¡æ‹Ÿæ—¶é—´åºåˆ—çš„å‘¨æœŸæ€?

$P$è¡¨ç¤ºæ—¶é—´åºåˆ—çš„å‘¨æœŸï¼Œ $P = 365.25$è¡¨ç¤ºä»¥å¹´ä¸ºå‘¨æœŸï¼Œ$P = 7$è¡¨ç¤ºä»¥å‘¨ä¸ºå‘¨æœŸã€‚å®ƒçš„å‚…ç«‹å¶çº§æ•°çš„å½¢å¼éƒ½æ˜¯ï¼š
$$
s(t)=\sum_{n=1}^{N}\left(a_{n} \cos \left(\frac{2 \pi n t}{P}\right)+b_{n} \sin \left(\frac{2 \pi n t}{P}\right)\right)
$$

## 6. èŠ‚å‡æ—¥æ•ˆåº”ï¼ˆholidays and eventsï¼?

é™¤äº†å‘¨æœ«ï¼ŒåŒæ ·æœ‰å¾ˆå¤šèŠ‚å‡æ—¥ï¼Œè€Œä¸”ä¸åŒçš„å›½å®¶æœ‰ç€ä¸åŒçš„å‡æœŸï¼Œä¸åŒçš„èŠ‚å‡æ—¥å¯ä»¥çœ‹æˆç›¸äº’ç‹¬ç«‹çš„æ¨¡å‹ï¼Œå¹¶ä¸”å¯ä»¥ä¸ºä¸åŒçš„èŠ‚å‡æ—¥è®¾ç½®ä¸åŒçš„å‰åçª—å£å€¼ï¼Œè¡¨ç¤ºè¯¥èŠ‚å‡æ—¥ä¼šå½±å“å‰åä¸€æ®µæ—¶é—´çš„æ—¶é—´åºåˆ—ã€?
$$
h(t)=Z(t) \boldsymbol{\kappa}=\sum_{i=1}^{L} \kappa_{i} \cdot 1_{\left\{t \in D_{i}\right\}}
$$
å…¶ä¸­ï¼?Z(t)=\left(1_{\left\{t \in D_{1}\right\}}, \cdots, 1_{\left\{t \in D_{L}\right\}}\right), \boldsymbol{\kappa}=\left(\kappa_{1}, \cdots, \kappa_{L}\right)^{T}$ï¼?\boldsymbol{\kappa} \sim \operatorname{Normal}\left(0, v^{2}\right)$

å¹¶ä¸”è¯¥æ­£æ€åˆ†å¸ƒæ˜¯å—åˆ°$v$ = holidays_prior_scale è¿™ä¸ªæŒ‡æ ‡å½±å“çš„ã€‚é»˜è®¤å€¼æ˜¯ 10ï¼Œå½“å€¼è¶Šå¤§æ—¶ï¼Œè¡¨ç¤ºèŠ‚å‡æ—¥å¯¹æ¨¡å‹çš„å½±å“è¶Šå¤§ï¼›å½“å€¼è¶Šå°æ—¶ï¼Œè¡¨ç¤ºèŠ‚å‡æ—¥å¯¹æ¨¡å‹çš„æ•ˆæœè¶Šå°



## 7. å‚æ•°

åœ?Prophet ä¸­ï¼Œç”¨æˆ·ä¸€èˆ¬å¯ä»¥è®¾ç½®ä»¥ä¸‹å››ç§å‚æ•°ï¼š

1. Capacityï¼šåœ¨å¢é‡å‡½æ•°æ˜¯é€»è¾‘å›å½’å‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦è®¾ç½®çš„å®¹é‡å€¼ã€?

2. Change Pointsï¼šå¯ä»¥é€šè¿‡ n_changepoints å’?changepoint_range æ¥è¿›è¡Œç­‰è·çš„å˜ç‚¹è®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡äººå·¥è®¾ç½®çš„æ–¹å¼æ¥æŒ‡å®šæ—¶é—´åºåˆ—çš„å˜ç‚¹ã€?

3. å­£èŠ‚æ€§å’ŒèŠ‚å‡æ—¥ï¼šå¯ä»¥æ ¹æ®å®é™…çš„ä¸šåŠ¡éœ€æ±‚æ¥æŒ‡å®šç›¸åº”çš„èŠ‚å‡æ—¥ã€?

4. å…‰æ»‘å‚æ•°ï¼?

    $\tau$ = changepoint_prior_scale å¯ä»¥ç”¨æ¥æ§åˆ¶è¶‹åŠ¿çš„çµæ´»åº¦

    $\sigma$ = seasonality_prior_scale ç”¨æ¥æ§åˆ¶å­£èŠ‚é¡¹çš„çµæ´»åº¦ï¼Œ

   $v$ =  holidays prior scale ç”¨æ¥æ§åˆ¶èŠ‚å‡æ—¥çš„çµæ´»åº¦ã€?





## å‚è€ƒèµ„æ–?

https://zhuanlan.zhihu.com/p/52330017

